/*!
* chartjs-plugin-annotation v3.0.0-beta
* undefined
 * (c) 2020 Chart.js Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["chartjs-plugin-annotation"]=e(t.Chart,t.Chart.helpers)}(this,(function(t,e){"use strict";function n(t,n){const a=function(t,n){let i=Number.POSITIVE_INFINITY;return t.filter((t=>t.inRange(n.x,n.y))).reduce(((t,o)=>{const a=o.getCenterPoint(),s=e.distanceBetweenPoints(n,a);return s<i?(t=[o],i=s):s===i&&t.push(o),t}),[]).sort(((t,e)=>{const n=t.getArea(),i=e.getArea();return n>i||n<i?n-i:t._index-e._index})).slice(0,1)[0]}(n,t),s=t.native,r=[];if("mousemove"===s.type)!function(t,e,n,a){a&&!a.hovering?["mouseenter","mouseover"].forEach((n=>{a.hovering=!0;const s=o(n,e);i(t,s,a)})):a||n.forEach((n=>{n.hovering&&(n.hovering=!1,["mouseout","mouseleave"].forEach((a=>{const s=o(a,e);i(t,s,n)})))}))}(r,s,n,a);else if(a&&function(t,e,n){const i=e.options||{};if("click"===t.type&&"function"==typeof i.onClick)return clearTimeout(e.clickTimeout),e.clickTimeout=setTimeout((()=>{delete e.clickTimeout,i.onClick.call(e,t)}),n),t.stopImmediatePropagation(),t.preventDefault(),!0;"dblclick"===t.type&&e.clickTimeout&&(clearTimeout(e.clickTimeout),delete e.clickTimeout)}(s,a))return;a&&0===r.length&&i(r,s,a),r.length>0&&(s.stopImmediatePropagation(),s.preventDefault(),r.forEach((t=>{t[0].call(t[2],t[1])})))}function i(t,e,n){var i;const o=(n.options||{})["on"+(i=e.type)[0].toUpperCase()+i.substring(1)];"function"==typeof o&&t.push([o,e,n])}function o(t,e){try{return new MouseEvent(t,e)}catch(n){try{const n=document.createEvent("MouseEvent");return n.initMouseEvent(t,e.canBubble,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),n}catch(n){const i=document.createEvent("Event");return i.initEvent(t,e.canBubble,e.cancelable),i}}}class a extends t.Element{inRange(t,e,n){const{x:i,y:o,width:a,height:s}=this.getProps(["x","y","width","height"],n);return t>=i&&t<=i+a&&e>=o&&e<=o+s}getCenterPoint(t){const{x:e,y:n,width:i,height:o}=this.getProps(["x","y","width","height"],t);return{x:e+i/2,y:n+o/2}}draw(t){const{x:e,y:n,width:i,height:o,options:a}=this;t.save(),t.lineWidth=a.borderWidth,t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,t.fillRect(e,n,i,o),t.strokeRect(e,n,i,o),t.restore()}}a.id="boxAnnotation",a.defaults={borderWidth:1},a.defaultRoutes={borderColor:"color",backgroundColor:"color"};const s=Math.PI,r=s/2,l=(t,e,n)=>({x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}),c=(t,e,n)=>l(e,n,Math.abs((t-e.y)/(n.y-e.y))).x,h=(t,e,n)=>l(e,n,Math.abs((t-e.x)/(n.x-e.x))).y;class d extends t.Element{intersects(t,e,n){n=n||.001;const i=this,o={x:i.x,y:i.y},a={x:i.x2,y:i.y2},s=h(t,o,a),r=c(e,o,a);return(!isFinite(s)||Math.abs(e-s)<n)&&(!isFinite(r)||Math.abs(t-r)<n)}labelIsVisible(){const t=this.options.label;return t&&t.enabled&&t.content}isOnLabel(t,e){const n=this.labelRect||{},i=n.width/2,o=n.height/2;return this.labelIsVisible()&&t>=n.x-i&&t<=n.x+i&&e>=n.y-o&&e<=n.y+o}inRange(t,e){const n=this.options.borderWidth||1;return this.intersects(t,e,n)||this.isOnLabel(t,e)}getCenterPoint(){return{x:(this.x2+this.x)/2,y:(this.y2+this.y)/2}}draw(t){const{x:n,y:i,x2:o,y2:a,options:d}=this;t.save(),t.lineWidth=d.borderWidth,t.strokeStyle=d.borderColor,t.setLineDash&&t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,t.beginPath(),t.moveTo(n,i),t.lineTo(o,a),t.stroke(),this.labelIsVisible()&&function(t,n){const i=n.options.label;t.font=e.fontString(i.font.size,i.font.style,i.font.family),t.textAlign="center";const{width:o,height:a}=function(t,n){const i=n.content,o=e.isArray(i)?i:[i],a=o.length;let s=0;for(let e=0;e<a;e++){const n=o[e];u.has(n)||u.set(n,t.measureText(n).width),s=Math.max(s,u.get(n))}return s+=2*n.xPadding,{width:s,height:a*n.font.size+(a+1)*n.yPadding}}(t,i),d=function(t,e,n){const i=t.options.label,{xPadding:o,xAdjust:a,yPadding:s,yAdjust:r}=i,d={x:t.x,y:t.y},u={x:t.x2,y:t.y2};let f,y,x;switch(i.position){case"top":y=s+r,f=c(y,d,u);break;case"bottom":y=n-s+r,f=c(y,d,u);break;case"left":f=o+a,y=h(f,d,u);break;case"right":f=e-o+a,y=h(f,d,u);break;default:x=l(d,u,.5),f=x.x+a,y=x.y+r}return{x:f,y:y}}(n,o,a);if(n.labelRect={x:d.x,y:d.y,width:o,height:a},t.translate(d.x,d.y),t.rotate(i.rotation*s/180),t.fillStyle=i.backgroundColor,function(t,e,n,i,o,a){if(a){const l=Math.min(a,o/2,i/2),c=e+l,h=n+l,d=e+i-l,u=n+o-l;t.moveTo(e,h),c<d&&h<u?(t.arc(c,h,l,-s,-r),t.arc(d,h,l,-r,0),t.arc(d,u,l,0,r),t.arc(c,u,l,r,s)):c<d?(t.moveTo(c,n),t.arc(d,h,l,-r,r),t.arc(c,h,l,r,s+r)):h<u?(t.arc(c,h,l,-s,0),t.arc(c,u,l,0,s)):t.arc(c,h,l,-s,s),t.closePath(),t.moveTo(e,n)}else t.rect(e,n,i,o)}(t,-o/2,-a/2,o,a,i.cornerRadius),t.fill(),t.fillStyle=i.font.color,e.isArray(i.content)){let e=-a/2+i.yPadding;for(let n=0;n<i.content.length;n++)t.textBaseline="top",t.fillText(i.content[n],-o/2+o/2,e),e+=i.font.size+i.yPadding}else t.textBaseline="middle",t.fillText(i.content,0,0)}(t,this),t.restore()}}d.id="lineAnnotation",d.defaults={borderDash:[],borderDashOffset:0,label:{backgroundColor:"rgba(0,0,0,0.8)",font:{family:t.defaults.font.family,size:t.defaults.font.size,style:"bold",color:"#fff"},xPadding:6,yPadding:6,rotation:0,cornerRadius:6,position:"center",xAdjust:0,yAdjust:0,enabled:!1,content:null}};const u=new Map;const f=new Map,y={box:a,line:d};var x={id:"annotation",beforeUpdate(t,n){!function(t,n){const i=t.scales||{};Object.keys(i).forEach((i=>{const o=t.scales[i];if(v.has(o))return;const a=o.afterDataLimits;o.afterDataLimits=function(...t){a&&a.apply(o,[...t]),function(t,n){const i=n.annotations||[],o=function(t,n){const i=t.axis,o=t.id,a=t.axis+"ScaleID",s=n.filter((t=>t[a]===o||t.scaleID===o));let r=e.valueOrDefault(t.min,Number.NEGATIVE_INFINITY),l=e.valueOrDefault(t.max,Number.POSITIVE_INFINITY);return s.forEach((t=>{["value","endValue",i+"Min",i+"Max"].forEach((e=>{if(e in t){const n=t[e];r=Math.min(r,n),l=Math.max(l,n)}}))})),{min:r,max:l}}(t,i);let a=!1;e.isFinite(o.min)&&void 0===t.options.min&&void 0===t.options.suggestedMin&&(t.min=o.min,a=!0);e.isFinite(o.max)&&void 0===t.options.max&&void 0===t.options.suggestedMax&&(t.max=o.max,a=!0);a&&"function"==typeof t.handleTickRangeOptions&&t.handleTickRangeOptions()}(o,n)},v.add(o)}))}(t,n)},afterUpdate(t,e){m(t,e)},resize(t,e){m(t,e,"resize")},beforeDatasetDraw(t,e){p(t,e,"beforeDatasetsDraw")},afterDatasetsDraw(t,e){p(t,e,"afterDatasetsDraw")},afterDraw(t,e){p(t,e,"afterDraw")},afterEvent(t,e,i,o){-1!==(o.events||[]).indexOf(e.type)&&n(e,f.get(t))},destroy(t){f.remove(t)},defaults:{drawTime:"afterDatasetsDraw",dblClickSpeed:350,events:[],annotations:[],animation:{numbers:{properties:["x","y","x2","y2","width","height"],type:"number"}}}};function m(n,i,o){const a=n.options.animation,s=a&&e.merge({},[a,i.animation]),r=new t.Animations(n,s,o),l=f.get(n)||f.set(n,[]).get(n),c=i.annotations||[],h=c.length,d=l.length;if(d<h){const t=h-d;l.splice(d,0,...new Array(t))}else d>h&&l.splice(h,d-h);for(let t=0;t<c.length;t++){const e=c[t];let i=l[t];const o=y[e.type]||y.line;i&&i instanceof o||(i=l[t]=new o);const a=b(n,e,o.defaults);r.update(i,a)}}const g=(t,n,i)=>e.isFinite(n)?t.getPixelForValue(n):i;function b(t,n,i){const o=t.scales[n.scaleID];let a,s,{top:r,left:l,bottom:c,right:h}=t.chartArea;if(o)a=g(o,n.value,NaN),s=g(o,n.endValue,a),o.isHorizontal()?(l=Math.min(a,s),h=Math.max(a,s)):(r=Math.min(a,s),c=Math.max(a,s));else{const e=t.scales[n.xScaleID],i=t.scales[n.yScaleID];e&&(a=g(e,n.xMin,l),s=g(e,n.xMax,h),l=Math.min(a,s),h=Math.max(a,s)),i&&(a=g(i,n.yMin,c),s=g(i,n.yMax,r),r=Math.min(a,s),c=Math.max(a,s))}return{x:l,y:r,x2:h,y2:c,width:h-l,height:c-r,options:e.merge(Object.create(null),[i,n])}}function p(t,n,i){const{ctx:o,chartArea:a}=t,s=f.get(t);e.clipArea(o,a);for(let t=0;t<s.length;t++){const e=s[t];(e.options.drawTime||n.drawTime||i)===i&&e.draw(o)}e.unclipArea(o)}const v=new WeakSet;return t.Chart.register(x,a,d),x}));
//# sourceMappingURL=chartjs-plugin-annotation.min.js.map
